<script>
<!--
document.write(unescape("%3Cscript%3E%0A%3C%21--%0Adocument.write%28unescape%28%22%3C%21DOCTYPE%20html%3E%0A%3Chtml%20lang%3D%22vi%22%3E%0A%3Chead%3E%0A%3Cmeta%20charset%3D%22utf-8%22%20/%3E%0A%3Cmeta%20name%3D%22viewport%22%20content%3D%22width%3Ddevice-width%2C%20initial-scale%3D1%2C%20viewport-fit%3Dcover%2C%20user-scalable%3Dno%22%20/%3E%0A%3Ctitle%3EAI%20Chat%20%u2013%20iOS%20Mobile%3C/title%3E%0A%3Cstyle%3E%0A%20%20%3Aroot%7B%0A%20%20%20%20--glass-bg%3A%20rgba%28255%2C255%2C255%2C0.95%29%3B%0A%20%20%20%20--glass-ring%3A%20rgba%280%2C0%2C0%2C.08%29%3B%0A%20%20%20%20--text%3A%20%23111%3B%0A%20%20%20%20--text-dim%3A%20%23999%3B%0A%20%20%20%20--bubble-user%3A%20%23007AFF%3B%0A%20%20%20%20--bubble-assistant%3A%20%23E5E5EA%3B%0A%20%20%20%20--bg%3A%20%23ffffff%3B%0A%20%20%20%20--danger%3A%20%23ff3b30%3B%0A%20%20%20%20--success%3A%2334C759%3B%0A%20%20%7D%0A%20%20*%7Bbox-sizing%3Aborder-box%3Bmargin%3A0%3Bpadding%3A0%7D%0A%20%20html%2Cbody%7Bheight%3A100%25%3Bbackground%3Avar%28--bg%29%7D%0A%20%20body%7B%0A%20%20%20%20font-family%3A-apple-system%2C%20BlinkMacSystemFont%2C%20%22SF%20Pro%20Text%22%2C%20Segoe%20UI%2C%20Roboto%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%20%20%20%20color%3Avar%28--text%29%3B%0A%20%20%7D%0A%20%20/*%20%3D%3D%3D%3D%3D%20Mobile%20Shell%20%28single%20column%29%20%3D%3D%3D%3D%3D%20*/%0A%20%20.app%7Bdisplay%3Aflex%3Bflex-direction%3Acolumn%3Bheight%3A100dvh%3Bmax-width%3A540px%3Bmargin%3A0%20auto%3Bbackground%3Avar%28--bg%29%7D%0A%20%20.safe-top%7Bheight%3A%20env%28safe-area-inset-top%29%7D%0A%20%20.safe-bottom%7Bheight%3A%20env%28safe-area-inset-bottom%29%7D%0A%20%20/*%20Top%20App%20Bar%20*/%0A%20%20.topbar%7B%20position%3Asticky%3Btop%3A0%3Bz-index%3A5%3B%20display%3Aflex%3Balign-items%3Acenter%3Bjustify-content%3Aspace-between%3Bgap%3A8px%3B%20padding%3A10px%2012px%20calc%2810px%20+%20env%28safe-area-inset-top%29%29%2012px%3B%20background%3Avar%28--glass-bg%29%3Bbackdrop-filter%3A%20blur%2816px%29%20saturate%28150%25%29%3B%20border-bottom%3A1px%20solid%20var%28--glass-ring%29%3B%20%7D%0A%20%20.title%7Bfont-weight%3A700%3Bfont-size%3A16px%3B%7D%0A%20%20.chip%7Bheight%3A28px%3Bpadding%3A0%2010px%3Bborder-radius%3A999px%3Bbackground%3A%23fff%3Bborder%3A1px%20solid%20var%28--glass-ring%29%3Bdisplay%3Aflex%3Balign-items%3Acenter%3Bgap%3A6px%3Bfont-size%3A12px%7D%0A%20%20.iconbtn%7Bborder%3A1px%20solid%20var%28--glass-ring%29%3Bbackground%3A%23fff%3Bborder-radius%3A12px%3Bpadding%3A8px%3Bdisplay%3Aflex%3Balign-items%3Acenter%3Bjustify-content%3Acenter%3Bmin-width%3A36px%7D%0A%0A%20%20/*%20Messages%20*/%0A%20%20.scroller%7Bflex%3A1%3Boverflow%3Aauto%3Bpadding%3A12px%3Bposition%3Arelative%7D%0A%20%20.empty-state%7Bposition%3Aabsolute%3Btop%3A50%25%3Bleft%3A50%25%3Btransform%3Atranslate%28-50%25%2C-50%25%29%3Btext-align%3Acenter%3Bcolor%3Avar%28--text-dim%29%3Bfont-size%3A15px%3Bopacity%3A0.6%3Bwidth%3A80%25%3Bpointer-events%3Anone%7D%0A%20%20.row%7Bdisplay%3Aflex%3Bwidth%3A100%25%3Bmargin-bottom%3A12px%3Banimation%3Afade%20.2s%7D%0A%20%20@keyframes%20fade%7Bfrom%7Bopacity%3A0%3Btransform%3AtranslateY%286px%29%7Dto%7Bopacity%3A1%3Btransform%3Anone%7D%7D%0A%20%20.bubble%7Bmax-width%3A86%25%3Bborder-radius%3A18px%3Bpadding%3A12px%2014px%3Bline-height%3A1.55%3Bfont-size%3A15px%3Bwhite-space%3Apre-wrap%3Bword-wrap%3Abreak-word%7D%0A%20%20.user%7Bjustify-content%3Aflex-end%7D%0A%20%20.assistant%7Bjustify-content%3Aflex-start%7D%0A%20%20.bubble.user%7Bbackground%3Avar%28--bubble-user%29%3Bcolor%3A%23fff%7D%0A%20%20.bubble.assistant%7Bbackground%3Avar%28--bubble-assistant%29%3Bcolor%3A%23111%7D%0A%20%20%0A%20%20/*%20Code%20blocks%20*/%0A%20%20.bubble%20pre%7B%0A%20%20%20%20background%3A%23f8f9fa%3B%0A%20%20%20%20color%3A%23333%3B%0A%20%20%20%20border-radius%3A10px%3B%0A%20%20%20%20padding%3A12px%3B%0A%20%20%20%20overflow-x%3Aauto%3B%0A%20%20%20%20margin%3A8px%200%3B%0A%20%20%20%20position%3Arelative%3B%0A%20%20%20%20border%3A1px%20solid%20%23e9ecef%3B%0A%20%20%20%20font-family%3Aui-monospace%2CSFMono-Regular%2CMenlo%2CConsolas%2Cmonospace%3B%0A%20%20%20%20font-size%3A13px%3B%0A%20%20%20%20line-height%3A1.5%3B%0A%20%20%7D%0A%20%20.bubble%20pre%20code%7B%0A%20%20%20%20background%3Atransparent%3B%0A%20%20%20%20padding%3A0%3B%0A%20%20%20%20border-radius%3A0%3B%0A%20%20%20%20color%3Ainherit%3B%0A%20%20%20%20display%3Ablock%3B%0A%20%20%7D%0A%20%20.code-header%7B%0A%20%20%20%20display%3Aflex%3B%0A%20%20%20%20justify-content%3Aspace-between%3B%0A%20%20%20%20align-items%3Acenter%3B%0A%20%20%20%20padding%3A6px%2010px%3B%0A%20%20%20%20background%3A%23e9ecef%3B%0A%20%20%20%20border-radius%3A8px%208px%200%200%3B%0A%20%20%20%20margin%3A-12px%20-12px%208px%20-12px%3B%0A%20%20%20%20font-size%3A11px%3B%0A%20%20%20%20color%3A%23666%3B%0A%20%20%20%20font-weight%3A600%3B%0A%20%20%7D%0A%20%20.copy-btn%7B%0A%20%20%20%20border%3Anone%3B%0A%20%20%20%20background%3A%23007AFF%3B%0A%20%20%20%20color%3A%23fff%3B%0A%20%20%20%20border-radius%3A6px%3B%0A%20%20%20%20padding%3A4px%2010px%3B%0A%20%20%20%20font-size%3A11px%3B%0A%20%20%20%20cursor%3Apointer%3B%0A%20%20%20%20font-weight%3A600%3B%0A%20%20%7D%0A%20%20.copy-btn%3Aactive%7Bbackground%3A%230051D5%7D%0A%20%20%0A%20%20.bubble%20code%7B%0A%20%20%20%20background%3Argba%280%2C0%2C0%2C.08%29%3B%0A%20%20%20%20padding%3A2px%206px%3B%0A%20%20%20%20border-radius%3A4px%3B%0A%20%20%20%20font-family%3Aui-monospace%2CSFMono-Regular%2CMenlo%2CConsolas%2Cmonospace%3B%0A%20%20%20%20font-size%3A13px%3B%0A%20%20%20%20color%3A%23d73a49%3B%0A%20%20%7D%0A%20%20.file-pill%7Bdisplay%3Ainline-flex%3Balign-items%3Acenter%3Bgap%3A6px%3Bpadding%3A6px%2010px%3Bborder-radius%3A999px%3Bbackground%3A%23fff%3Bborder%3A1px%20solid%20var%28--glass-ring%29%3Bfont-size%3A12px%3Bmargin-top%3A6px%7D%0A%0A%20%20/*%20Image%20preview%20in%20messages%20*/%0A%20%20.image-attachment%7Bmax-width%3A200px%3Bborder-radius%3A12px%3Bmargin-top%3A8px%3Bborder%3A1px%20solid%20var%28--glass-ring%29%7D%0A%0A%20%20/*%20Thinking%20card%20*/%0A%20%20.thinking%7Bposition%3Asticky%3Bbottom%3A76px%3Bz-index%3A2%3Bmargin%3A0%2012px%206px%2012px%3Bpadding%3A10px%3Bbackground%3Avar%28--glass-bg%29%3Bbackdrop-filter%3A%20blur%2816px%29%3Bborder%3A1px%20solid%20var%28--glass-ring%29%3Bborder-radius%3A14px%3Bdisplay%3Anone%3Bopacity%3A0%3Btransform%3AtranslateY%2810px%29%3Btransition%3Aopacity%200.3s%2C%20transform%200.3s%7D%0A%20%20.thinking.show%7Bopacity%3A1%3Btransform%3AtranslateY%280%29%7D%0A%20%20.thinking.fade-out%7Bopacity%3A0%3Btransform%3AtranslateY%28-10px%29%7D%0A%20%20.think-head%7Bdisplay%3Aflex%3Balign-items%3Acenter%3Bjustify-content%3Aspace-between%7D%0A%20%20.spinner%7Bwidth%3A14px%3Bheight%3A14px%3Bborder-radius%3A50%25%3Bborder%3A2px%20solid%20%23007AFF%3Bborder-top-color%3Atransparent%3Banimation%3Aspin%20.8s%20linear%20infinite%3Bdisplay%3Ainline-block%7D%0A%20%20@keyframes%20spin%7Bto%7Btransform%3Arotate%28360deg%29%7D%7D%0A%20%20.dots%7Bdisplay%3Agrid%3Bgap%3A6px%3Bmargin-top%3A8px%7D%0A%20%20.dot%7Bdisplay%3Aflex%3Balign-items%3Acenter%3Bgap%3A8px%3Bfont-size%3A13px%3Bcolor%3Avar%28--text-dim%29%7D%0A%20%20.dot%20i%7Bwidth%3A8px%3Bheight%3A8px%3Bborder-radius%3A50%25%3Bbackground%3A%23bbb%7D%0A%20%20.dot.active%20i%7Bbackground%3A%23007AFF%7D%0A%20%20.dot.done%20i%7Bbackground%3Avar%28--success%29%7D%0A%0A%20%20/*%20Composer%20pinned%20at%20bottom%20*/%0A%20%20.composer%7B%20position%3Asticky%3Bbottom%3A0%3Bz-index%3A3%3B%20padding%3A8px%208px%20calc%288px%20+%20env%28safe-area-inset-bottom%29%29%3B%20background%3Alinear-gradient%28180deg%2C%20rgba%28255%2C255%2C255%2C0%29%200%25%2C%20rgba%28255%2C255%2C255%2C1%29%2018%25%29%3B%20%7D%0A%20%20.card%7Bbackground%3Avar%28--glass-bg%29%3Bbackdrop-filter%3A%20blur%2816px%29%3Bborder%3A1px%20solid%20var%28--glass-ring%29%3Bborder-radius%3A16px%3Bpadding%3A8px%7D%0A%20%20.rowwrap%7Bdisplay%3Aflex%3Balign-items%3Aflex-end%3Bgap%3A8px%7D%0A%20%20textarea%7Bflex%3A1%3Bmin-height%3A42px%3Bmax-height%3A140px%3Bresize%3Anone%3Bborder%3A1px%20solid%20var%28--glass-ring%29%3Bborder-radius%3A12px%3Bpadding%3A10px%2012px%3Bbackground%3A%23fff%3Bfont-size%3A15px%3Boutline%3Anone%7D%0A%20%20.send%7Bbackground%3A%23007AFF%3Bcolor%3A%23fff%3Bborder%3Anone%3Bborder-radius%3A12px%3Bpadding%3A12px%2014px%3Bfont-weight%3A700%3Bmin-width%3A64px%7D%0A%20%20.toolbtn%7Bborder%3A1px%20solid%20var%28--glass-ring%29%3Bbackground%3A%23fff%3Bborder-radius%3A12px%3Bpadding%3A10px%3Bmin-width%3A42px%7D%0A%20%20.attach-list%7Bdisplay%3Aflex%3Bflex-wrap%3Awrap%3Bgap%3A6px%3Bmargin-top%3A6px%7D%0A%0A%20%20/*%20Bottom%20Tabbar%20%28actions%29%20*/%0A%20%20.tabbar%7Bposition%3Afixed%3Bleft%3A0%3Bright%3A0%3Bbottom%3A0%3Bz-index%3A2%3Bdisplay%3Aflex%3Bjustify-content%3Aspace-around%3Bgap%3A8px%3Bmax-width%3A540px%3Bmargin%3A0%20auto%3Bpadding%3A8px%2010px%20calc%288px%20+%20env%28safe-area-inset-bottom%29%29%3Bbackground%3Avar%28--glass-bg%29%3Bbackdrop-filter%3Ablur%2814px%29%3Bborder-top%3A1px%20solid%20var%28--glass-ring%29%7D%0A%20%20.tabbar%20.tbtn%7Bflex%3A1%3Bdisplay%3Aflex%3Bflex-direction%3Acolumn%3Balign-items%3Acenter%3Bgap%3A4px%3Bborder%3Anone%3Bbackground%3Atransparent%3Bfont-size%3A12px%3Bcolor%3A%23222%7D%0A%0A%20%20/*%20Sheets%20*/%0A%20%20.sheet-backdrop%7Bposition%3Afixed%3Binset%3A0%3Bbackground%3Argba%280%2C0%2C0%2C.3%29%3Bbackdrop-filter%3Ablur%284px%29%3Bopacity%3A0%3Bpointer-events%3Anone%3Btransition%3A.2s%3Bz-index%3A9%7D%0A%20%20.sheet%7Bposition%3Afixed%3Bleft%3A0%3Bright%3A0%3Bbottom%3A0%3Bz-index%3A10%3Btransform%3AtranslateY%28100%25%29%3Btransition%3A.25s%7D%0A%20%20.sheet.open%7Btransform%3Anone%7D%0A%20%20.sheet-backdrop.open%7Bopacity%3A1%3Bpointer-events%3Aauto%7D%0A%20%20.sheet%20.panel%7Bmax-width%3A540px%3Bmargin%3A0%20auto%3Bborder-top-left-radius%3A16px%3Bborder-top-right-radius%3A16px%3Bbackground%3Avar%28--glass-bg%29%3Bbackdrop-filter%3Ablur%2816px%29%3Bborder%3A1px%20solid%20var%28--glass-ring%29%3Bpadding%3A12px%7D%0A%20%20.form%7Bdisplay%3Agrid%3Bgap%3A10px%7D%0A%20%20.label%7Bfont-size%3A12px%3Bcolor%3Avar%28--text-dim%29%3Bfont-weight%3A700%7D%0A%20%20.input%2C.select%2C.textarea%7Bborder%3A1px%20solid%20var%28--glass-ring%29%3Bborder-radius%3A12px%3Bpadding%3A10px%2012px%3Bbackground%3A%23fff%3Bfont-size%3A15px%7D%0A%20%20.row-between%7Bdisplay%3Aflex%3Balign-items%3Acenter%3Bjustify-content%3Aspace-between%7D%0A%20%20.btn%7Bborder%3A1px%20solid%20var%28--glass-ring%29%3Bbackground%3A%23fff%3Bborder-radius%3A12px%3Bpadding%3A10px%2012px%7D%0A%20%20.btn.primary%7Bbackground%3A%23007AFF%3Bcolor%3A%23fff%3Bborder-color%3Atransparent%7D%0A%20%20.btn.danger%7Bbackground%3Avar%28--danger%29%3Bcolor%3A%23fff%3Bborder-color%3Atransparent%7D%0A%0A%20%20/*%20Three%20dots%20animation%20for%20AI%20messages%20*/%0A%20%20.typing-dots%7Bdisplay%3Ainline-flex%3Balign-items%3Acenter%3Bheight%3A20px%7D%0A%20%20.typing-dots%20span%7Bdisplay%3Ainline-block%3Bwidth%3A4px%3Bheight%3A4px%3Bborder-radius%3A50%25%3Bbackground%3A%23666%3Bmargin%3A0%201px%3Banimation%3Atyping%201.4s%20infinite%20ease-in-out%7D%0A%20%20.typing-dots%20span%3Anth-child%281%29%7Banimation-delay%3A-0.32s%7D%0A%20%20.typing-dots%20span%3Anth-child%282%29%7Banimation-delay%3A-0.16s%7D%0A%20%20@keyframes%20typing%7B%0A%20%20%20%200%25%2C%2080%25%2C%20100%25%7Btransform%3Ascale%280.8%29%3Bopacity%3A0.5%7D%0A%20%20%20%2040%25%7Btransform%3Ascale%281%29%3Bopacity%3A1%7D%0A%20%20%7D%0A%0A%20%20.hidden%7Bdisplay%3Anone%21important%7D%0A%3C/style%3E%0A%0A%3Clink%20rel%3D%22stylesheet%22%20href%3D%22https%3A//cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css%22%20crossorigin%3D%22anonymous%22%3E%0A%3Cscript%20defer%20src%3D%22https%3A//cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js%22%20crossorigin%3D%22anonymous%22%3E%3C/script%3E%0A%3Cscript%20defer%20src%3D%22https%3A//cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js%22%20crossorigin%3D%22anonymous%22%3E%3C/script%3E%0A%3C/head%3E%0A%3Cbody%3E%0A%3Cdiv%20class%3D%22app%22%3E%0A%20%20%3Cdiv%20class%3D%22topbar%22%3E%0A%20%20%20%20%3Cbutton%20id%3D%22btnMenu%22%20class%3D%22iconbtn%22%20aria-label%3D%22H%u1ED9i%20tho%u1EA1i%22%3E%u2630%3C/button%3E%0A%20%20%20%20%3Cdiv%20class%3D%22title%22%3ED%u01B0%u01A1ng%20Api%3C/div%3E%0A%20%20%20%20%3Cdiv%20id%3D%22modelChip%22%20class%3D%22chip%22%3ESonnet%204.5%3C/div%3E%0A%20%20%3C/div%3E%0A%20%20%3Cdiv%20id%3D%22thinkCard%22%20class%3D%22thinking%22%3E%0A%20%20%20%20%3Cdiv%20class%3D%22think-head%22%3E%0A%20%20%20%20%20%20%3Cdiv%20style%3D%22display%3Aflex%3Balign-items%3Acenter%3Bgap%3A8px%22%3E%0A%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22spinner%22%3E%3C/span%3E%0A%20%20%20%20%20%20%20%20%3Cstrong%3E%u0110ang%20suy%20ngh%u0129%u2026%3C/strong%3E%0A%20%20%20%20%20%20%3C/div%3E%0A%20%20%20%20%20%20%3Cbutton%20id%3D%22btnToggleThink%22%20class%3D%22btn%22%3EThu%20g%u1ECDn%3C/button%3E%0A%20%20%20%20%3C/div%3E%0A%20%20%20%20%3Cdiv%20id%3D%22thinkBody%22%3E%0A%20%20%20%20%20%20%3Cdiv%20id%3D%22dots%22%20class%3D%22dots%22%3E%3C/div%3E%0A%20%20%20%20%3C/div%3E%0A%20%20%3C/div%3E%0A%20%20%3Cdiv%20id%3D%22scroller%22%20class%3D%22scroller%22%20aria-live%3D%22polite%22%3E%0A%20%20%20%20%3Cdiv%20class%3D%22empty-state%22%3EH%E3y%20g%u1EEDi%20tin%20nh%u1EAFn%20%u0111%u1EC3%20b%u1EAFt%20%u0111%u1EA7u%20%u0111o%u1EA1n%20chat%3C/div%3E%0A%20%20%3C/div%3E%0A%20%20%3Cdiv%20class%3D%22composer%22%3E%0A%20%20%20%20%3Cdiv%20class%3D%22card%22%3E%0A%20%20%20%20%20%20%3Cform%20id%3D%22form%22%20class%3D%22rowwrap%22%3E%0A%20%20%20%20%20%20%20%20%3Cbutton%20id%3D%22btnAttach%22%20class%3D%22toolbtn%22%20type%3D%22button%22%20title%3D%22%u0110%EDnh%20k%E8m%22%3E%uD83D%uDCCE%3C/button%3E%0A%20%20%20%20%20%20%20%20%3Ctextarea%20id%3D%22text%22%20placeholder%3D%22Nh%u1EADp%20tin%20nh%u1EAFn%u2026%22%20rows%3D%221%22%3E%3C/textarea%3E%0A%20%20%20%20%20%20%20%20%3Cbutton%20id%3D%22send%22%20class%3D%22send%22%20type%3D%22submit%22%3EG%u1EEDi%3C/button%3E%0A%20%20%20%20%20%20%3C/form%3E%0A%20%20%20%20%20%20%3Cdiv%20id%3D%22attachList%22%20class%3D%22attach-list%22%3E%3C/div%3E%0A%20%20%20%20%3C/div%3E%0A%20%20%3C/div%3E%0A%20%20%3Cdiv%20class%3D%22tabbar%22%3E%0A%20%20%20%20%3Cbutton%20id%3D%22btnMic%22%20class%3D%22tbtn%22%20type%3D%22button%22%3E%uD83C%uDFA4%3Cspan%3EGi%u1ECDng%20n%F3i%3C/span%3E%3C/button%3E%0A%20%20%20%20%3Cbutton%20id%3D%22btnSpeak%22%20class%3D%22tbtn%22%20type%3D%22button%22%3E%uD83D%uDD08%3Cspan%3E%u0110%u1ECDc%3C/span%3E%3C/button%3E%0A%20%20%20%20%3Cbutton%20id%3D%22btnNewChat%22%20class%3D%22tbtn%22%20type%3D%22button%22%3E%u2795%3Cspan%3EChat%20m%u1EDBi%3C/span%3E%3C/button%3E%0A%20%20%3C/div%3E%0A%3C/div%3E%0A%0A%3C%21--%20Drawer%3A%20Chat%20list%20with%20Settings%20--%3E%0A%3Cdiv%20id%3D%22backdropList%22%20class%3D%22sheet-backdrop%22%3E%3C/div%3E%0A%3Cdiv%20id%3D%22sheetList%22%20class%3D%22sheet%22%3E%0A%20%20%3Cdiv%20class%3D%22panel%22%3E%0A%20%20%20%20%3Cdiv%20class%3D%22row-between%22%20style%3D%22margin-bottom%3A6px%22%3E%0A%20%20%20%20%20%20%3Cdiv%20style%3D%22font-weight%3A700%22%3EH%u1ED9i%20tho%u1EA1i%3C/div%3E%0A%20%20%20%20%20%20%3Cdiv%3E%0A%20%20%20%20%20%20%20%20%3Cbutton%20id%3D%22btnSettingsInList%22%20class%3D%22btn%22%20style%3D%22margin-right%3A8px%22%3E%u2699%uFE0F%3C/button%3E%0A%20%20%20%20%20%20%20%20%3Cbutton%20id%3D%22closeList%22%20class%3D%22btn%22%3E%u2716%3C/button%3E%0A%20%20%20%20%20%20%3C/div%3E%0A%20%20%20%20%3C/div%3E%0A%20%20%20%20%3Cdiv%20style%3D%22display%3Aflex%3Bgap%3A8px%3Bmargin-bottom%3A12px%22%3E%0A%20%20%20%20%20%20%3Cbutton%20id%3D%22btnNewChatInList%22%20class%3D%22btn%20primary%22%20style%3D%22flex%3A1%22%3E+%20T%u1EA1o%20%u0111o%u1EA1n%20chat%20m%u1EDBi%3C/button%3E%0A%20%20%20%20%20%20%3Cbutton%20id%3D%22btnClearHistory%22%20class%3D%22btn%20danger%22%20title%3D%22X%F3a%20to%E0n%20b%u1ED9%20l%u1ECBch%20s%u1EED%22%3E%uD83D%uDDD1%uFE0F%3C/button%3E%0A%20%20%20%20%3C/div%3E%0A%20%20%20%20%3Cdiv%20id%3D%22chatList%22%20style%3D%22display%3Agrid%3Bgap%3A6px%3Bmax-height%3A50dvh%3Boverflow%3Aauto%22%3E%3C/div%3E%0A%20%20%20%20%3Cdiv%20style%3D%22display%3Aflex%3Bgap%3A8px%3Bmargin-top%3A8px%22%3E%0A%20%20%20%20%20%20%3Cbutton%20id%3D%22btnExportMd%22%20class%3D%22btn%22%20style%3D%22flex%3A1%22%3E%u2B07%uFE0F%20Markdown%3C/button%3E%0A%20%20%20%20%20%20%3Cbutton%20id%3D%22btnExportJson%22%20class%3D%22btn%22%20style%3D%22flex%3A1%22%3E%u2B07%uFE0F%20JSON%3C/button%3E%0A%20%20%20%20%3C/div%3E%0A%20%20%3C/div%3E%0A%3C/div%3E%0A%0A%3C%21--%20Bottom%20sheet%3A%20Settings%20--%3E%0A%3Cdiv%20id%3D%22backdrop%22%20class%3D%22sheet-backdrop%22%3E%3C/div%3E%0A%3Cdiv%20id%3D%22sheet%22%20class%3D%22sheet%22%3E%0A%20%20%3Cdiv%20class%3D%22panel%22%3E%0A%20%20%20%20%3Cdiv%20class%3D%22row-between%22%20style%3D%22margin-bottom%3A6px%22%3E%3Cdiv%20style%3D%22font-weight%3A700%22%3EC%E0i%20%u0111%u1EB7t%3C/div%3E%3Cbutton%20id%3D%22closeSheet%22%20class%3D%22btn%22%3E%u2716%3C/button%3E%3C/div%3E%0A%20%20%20%20%3Cdiv%20class%3D%22form%22%3E%0A%20%20%20%20%20%20%3Clabel%20class%3D%22label%22%3EAPI%20Key%20%28Anthropic%29%0A%20%20%20%20%20%20%20%20%3Cinput%20id%3D%22inpKey%22%20class%3D%22input%22%20type%3D%22password%22%20placeholder%3D%22sk-ant-%u2026%22/%3E%0A%20%20%20%20%20%20%3C/label%3E%0A%20%20%20%20%20%20%3Clabel%20class%3D%22label%22%3EModel%20%28T%u1EEB%20r%u1EBB%20%u0111%u1EBFn%20%u0111%u1EAFt%29%0A%20%20%20%20%20%20%20%20%3Cselect%20id%3D%22inpModel%22%20class%3D%22select%22%3E%0A%20%20%20%20%20%20%20%20%20%20%3Coption%20value%3D%22claude-3-5-haiku-20241022%22%3EClaude%203.5%20Haiku%20%uD83D%uDCB0%3C/option%3E%0A%20%20%20%20%20%20%20%20%20%20%3Coption%20value%3D%22claude-3-5-sonnet-20241022%22%3EClaude%203.5%20Sonnet%20%uD83D%uDCB0%uD83D%uDCB0%3C/option%3E%0A%20%20%20%20%20%20%20%20%20%20%3Coption%20value%3D%22claude-sonnet-4-20250514%22%3EClaude%20Sonnet%204%20%uD83D%uDCB0%uD83D%uDCB0%uD83D%uDCB0%3C/option%3E%0A%20%20%20%20%20%20%20%20%20%20%3Coption%20value%3D%22claude-sonnet-4-5-20250929%22%3EClaude%20Sonnet%204.5%20%uD83D%uDCB0%uD83D%uDCB0%uD83D%uDCB0%uD83D%uDCB0%3C/option%3E%0A%20%20%20%20%20%20%20%20%20%20%3Coption%20value%3D%22claude-opus-4-20250514%22%3EClaude%20Opus%204%20%uD83D%uDCB0%uD83D%uDCB0%uD83D%uDCB0%uD83D%uDCB0%uD83D%uDCB0%3C/option%3E%0A%20%20%20%20%20%20%20%20%20%20%3Coption%20value%3D%22claude-opus-4-1-20250805%22%3EClaude%20Opus%204.1%20Pro%20%uD83D%uDCB0%uD83D%uDCB0%uD83D%uDCB0%uD83D%uDCB0%uD83D%uDCB0%uD83D%uDCB0%3C/option%3E%0A%20%20%20%20%20%20%20%20%3C/select%3E%0A%20%20%20%20%20%20%3C/label%3E%0A%20%20%20%20%20%20%3Cdiv%20style%3D%22display%3Agrid%3Bgrid-template-columns%3A1fr%201fr%3Bgap%3A8px%22%3E%0A%20%20%20%20%20%20%20%20%3Clabel%20class%3D%22label%22%3ETemperature%0A%20%20%20%20%20%20%20%20%20%20%3Cinput%20id%3D%22inpTemp%22%20class%3D%22input%22%20type%3D%22number%22%20min%3D%220%22%20max%3D%221.5%22%20step%3D%220.1%22%20value%3D%220.7%22/%3E%0A%20%20%20%20%20%20%20%20%3C/label%3E%0A%20%20%20%20%20%20%20%20%3Clabel%20class%3D%22label%22%3EMax%20tokens%0A%20%20%20%20%20%20%20%20%20%20%3Cinput%20id%3D%22inpMaxTok%22%20class%3D%22input%22%20type%3D%22number%22%20min%3D%22256%22%20max%3D%228192%22%20value%3D%224096%22/%3E%0A%20%20%20%20%20%20%20%20%3C/label%3E%0A%20%20%20%20%20%20%3C/div%3E%0A%20%20%20%20%20%20%3Clabel%20class%3D%22label%22%3ESystem%20prompt%0A%20%20%20%20%20%20%20%20%3Ctextarea%20id%3D%22inpSystem%22%20class%3D%22textarea%22%20rows%3D%223%22%20placeholder%3D%22B%u1EA1n%20l%E0%20tr%u1EE3%20l%FD%20h%u1EEFu%20%EDch%u2026%22%3E%3C/textarea%3E%0A%20%20%20%20%20%20%3C/label%3E%0A%20%20%20%20%20%20%3Cdiv%20style%3D%22display%3Aflex%3Bgap%3A8px%22%3E%0A%20%20%20%20%20%20%20%20%3Cbutton%20id%3D%22btnSaveCfg%22%20class%3D%22btn%20primary%22%20style%3D%22flex%3A1%22%3EL%u01B0u%3C/button%3E%0A%20%20%20%20%20%20%20%20%3Cbutton%20id%3D%22btnClearChat%22%20class%3D%22btn%22%20style%3D%22flex%3A1%3Bcolor%3A%23d00%3Bborder-color%3A%23ffd4d1%22%3EX%F3a%20chat%20hi%u1EC7n%20t%u1EA1i%3C/button%3E%0A%20%20%20%20%20%20%3C/div%3E%0A%20%20%20%20%3C/div%3E%0A%20%20%3C/div%3E%0A%3C/div%3E%0A%0A%3Cinput%20id%3D%22file%22%20type%3D%22file%22%20accept%3D%22image/*%2C.txt%2C.md%2C.json%2C.pdf%22%20hidden%20/%3E%0A%0A%3Cscript%3E%0Aconst%20DEFAULT_API_KEY%20%3D%20%27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%27%3B%0A%0A%28function%28%29%7B%0A%20%20%22use%20strict%22%3B%0A%20%20%0A%20%20const%20%24%20%3D%20%28q%29%3D%3Edocument.querySelector%28q%29%3B%0A%20%20const%20scroller%20%3D%20%24%28%27%23scroller%27%29%3B%0A%20%20const%20text%20%3D%20%24%28%27%23text%27%29%3B%0A%20%20const%20sendBtn%20%3D%20%24%28%27%23send%27%29%3B%0A%20%20const%20think%20%3D%20%24%28%27%23thinkCard%27%29%3B%0A%20%20const%20dots%20%3D%20%24%28%27%23dots%27%29%3B%0A%20%20const%20btnToggleThink%20%3D%20%24%28%27%23btnToggleThink%27%29%3B%0A%20%20const%20modelChip%20%3D%20%24%28%27%23modelChip%27%29%3B%0A%20%20const%20emptyState%20%3D%20scroller.querySelector%28%27.empty-state%27%29%3B%0A%0A%20%20const%20CFG%20%3D%20%7B%0A%20%20%20%20key%3A%20localStorage.getItem%28%27anthropicKey%27%29%20%7C%7C%20DEFAULT_API_KEY%2C%0A%20%20%20%20model%3A%20localStorage.getItem%28%27claudeModel%27%29%20%7C%7C%20%27claude-sonnet-4-5-20250929%27%2C%0A%20%20%20%20temp%3A%20Number%28localStorage.getItem%28%27temp%27%29%20%7C%7C%20%270.7%27%29%2C%0A%20%20%20%20max_tokens%3A%20Number%28localStorage.getItem%28%27maxTokens%27%29%20%7C%7C%20%274096%27%29%2C%0A%20%20%20%20system%3A%20localStorage.getItem%28%27system%27%29%20%7C%7C%20%27%27%0A%20%20%7D%3B%0A%20%20%0A%20%20function%20saveCfg%28%29%7B%0A%20%20%20%20localStorage.setItem%28%27anthropicKey%27%2C%20CFG.key%29%3B%0A%20%20%20%20localStorage.setItem%28%27claudeModel%27%2C%20CFG.model%29%3B%0A%20%20%20%20localStorage.setItem%28%27temp%27%2C%20String%28CFG.temp%29%29%3B%0A%20%20%20%20localStorage.setItem%28%27maxTokens%27%2C%20String%28CFG.max_tokens%29%29%3B%0A%20%20%20%20localStorage.setItem%28%27system%27%2C%20CFG.system%29%3B%0A%20%20%7D%0A%0A%20%20let%20CURRENT%20%3D%20null%3B%0A%20%20const%20store%20%3D%20%7B%0A%20%20%20%20list%3A%20%28%29%3D%3E%20JSON.parse%28localStorage.getItem%28%27aiChats%27%29%7C%7C%27%5B%5D%27%29%2C%0A%20%20%20%20save%3A%20%28arr%29%3D%3E%20localStorage.setItem%28%27aiChats%27%2C%20JSON.stringify%28arr%29%29%2C%0A%20%20%20%20upsert%3A%20%28chat%29%3D%3E%7Bconst%20arr%3Dstore.list%28%29%3Bconst%20i%3Darr.findIndex%28c%3D%3Ec.id%3D%3D%3Dchat.id%29%3Bif%28i%3E%3D0%29arr%5Bi%5D%3Dchat%3Belse%20arr.unshift%28chat%29%3Bstore.save%28arr%29%3B%7D%2C%0A%20%20%20%20get%3A%20id%3D%3E%20store.list%28%29.find%28c%3D%3Ec.id%3D%3D%3Did%29%2C%0A%20%20%20%20remove%3A%20id%3D%3E%20store.save%28store.list%28%29.filter%28c%3D%3Ec.id%21%3D%3Did%29%29%2C%0A%20%20%20%20clear%3A%20%28%29%3D%3E%20%7BlocalStorage.removeItem%28%27aiChats%27%29%3B%7D%0A%20%20%7D%3B%0A%20%20%0A%20%20function%20uid%28%29%7Breturn%20%27c_%27+Math.random%28%29.toString%2836%29.slice%282%29%7D%0A%0A%20%20function%20newChat%28seed%29%7B%0A%20%20%20%20CURRENT%20%3D%20%7Bid%3Auid%28%29%2Ctitle%3A%27Cu%u1ED9c%20tr%F2%20chuy%u1EC7n%20m%u1EDBi%27%2Cmodel%3ACFG.model%2Ccreated%3ADate.now%28%29%2Cmsgs%3A%20seed%3F%5Bseed%5D%3A%5B%5D%7D%3B%0A%20%20%20%20store.upsert%28CURRENT%29%3B%0A%20%20%20%20renderList%28%29%3B%0A%20%20%20%20scroller.innerHTML%20%3D%20%27%3Cdiv%20class%3D%22empty-state%22%3EH%E3y%20g%u1EEDi%20tin%20nh%u1EAFn%20%u0111%u1EC3%20b%u1EAFt%20%u0111%u1EA7u%20%u0111o%u1EA1n%20chat%3C/div%3E%27%3B%0A%20%20%7D%0A%20%20%0A%20%20function%20loadChat%28id%29%7B%0A%20%20%20%20const%20c%20%3D%20store.get%28id%29%3B%0A%20%20%20%20if%28%21c%29%20return%3B%0A%20%20%20%20CURRENT%3Dc%3B%0A%20%20%20%20scroller.innerHTML%3D%27%3Cdiv%20class%3D%22empty-state%22%3EH%E3y%20g%u1EEDi%20tin%20nh%u1EAFn%20%u0111%u1EC3%20b%u1EAFt%20%u0111%u1EA7u%20%u0111o%u1EA1n%20chat%3C/div%3E%27%3B%0A%20%20%20%20c.msgs.forEach%28m%3D%3E%7B%0A%20%20%20%20%20%20const%20b%3DaddMsg%28m.role%2Cm.content%2Cm.attachments%29%3B%0A%20%20%20%20%20%20if%28m.role%3D%3D%3D%27assistant%27%29%20renderMath%28b%29%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20renderList%28%29%3B%0A%20%20%7D%0A%20%20%0A%20%20function%20saveCurrent%28%29%7Bif%28CURRENT%29%20store.upsert%28CURRENT%29%7D%0A%0A%20%20const%20sheetList%20%3D%20%24%28%27%23sheetList%27%29%3B%0A%20%20const%20backdropList%20%3D%20%24%28%27%23backdropList%27%29%3B%0A%20%20const%20chatList%20%3D%20%24%28%27%23chatList%27%29%3B%0A%20%20%0A%20%20%24%28%27%23btnMenu%27%29.onclick%20%3D%20%28%29%3D%3E%7BbackdropList.classList.add%28%27open%27%29%3BsheetList.classList.add%28%27open%27%29%3BrenderList%28%29%3B%7D%3B%0A%20%20%24%28%27%23closeList%27%29.onclick%20%3D%20%28%29%3D%3E%7BbackdropList.classList.remove%28%27open%27%29%3BsheetList.classList.remove%28%27open%27%29%3B%7D%3B%0A%20%20backdropList.onclick%20%3D%20%24%28%27%23closeList%27%29.onclick%3B%0A%0A%20%20%24%28%27%23btnNewChatInList%27%29.onclick%20%3D%20%28%29%3D%3E%7B%0A%20%20%20%20newChat%28%29%3B%0A%20%20%20%20backdropList.classList.remove%28%27open%27%29%3B%0A%20%20%20%20sheetList.classList.remove%28%27open%27%29%3B%0A%20%20%7D%3B%0A%0A%20%20%24%28%27%23btnClearHistory%27%29.onclick%20%3D%20%28%29%3D%3E%7B%0A%20%20%20%20if%28confirm%28%27B%u1EA1n%20c%F3%20ch%u1EAFc%20mu%u1ED1n%20x%F3a%20to%E0n%20b%u1ED9%20l%u1ECBch%20s%u1EED%20tr%F2%20chuy%u1EC7n%3F%27%29%29%20%7B%0A%20%20%20%20%20%20store.clear%28%29%3B%0A%20%20%20%20%20%20newChat%28%29%3B%0A%20%20%20%20%20%20backdropList.classList.remove%28%27open%27%29%3B%0A%20%20%20%20%20%20sheetList.classList.remove%28%27open%27%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%3B%0A%0A%20%20%24%28%27%23btnSettingsInList%27%29.onclick%20%3D%20%28%29%3D%3E%7B%0A%20%20%20%20backdropList.classList.remove%28%27open%27%29%3B%0A%20%20%20%20sheetList.classList.remove%28%27open%27%29%3B%0A%20%20%20%20openSettings%28%29%3B%0A%20%20%7D%3B%0A%0A%20%20function%20renderList%28%29%7B%0A%20%20%20%20chatList.innerHTML%3D%27%27%3B%0A%20%20%20%20const%20arr%20%3D%20store.list%28%29%3B%0A%20%20%20%20arr.forEach%28c%3D%3E%7B%0A%20%20%20%20%20%20const%20item%20%3D%20document.createElement%28%27div%27%29%3B%0A%20%20%20%20%20%20item.style.display%20%3D%20%27flex%27%3B%0A%20%20%20%20%20%20item.style.alignItems%20%3D%20%27center%27%3B%0A%20%20%20%20%20%20item.style.gap%20%3D%20%278px%27%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20const%20chatBtn%20%3D%20document.createElement%28%27button%27%29%3B%0A%20%20%20%20%20%20chatBtn.className%3D%27btn%27%3B%0A%20%20%20%20%20%20chatBtn.style.textAlign%3D%27left%27%3B%0A%20%20%20%20%20%20chatBtn.style.flex%20%3D%20%271%27%3B%0A%20%20%20%20%20%20chatBtn.style.display%3D%27flex%27%3B%0A%20%20%20%20%20%20chatBtn.style.justifyContent%3D%27space-between%27%3B%0A%20%20%20%20%20%20chatBtn.style.alignItems%3D%27center%27%3B%0A%20%20%20%20%20%20chatBtn.innerHTML%20%3D%20%60%3Cspan%20style%3D%22font-weight%3A600%3Bmax-width%3A70%25%3Boverflow%3Ahidden%3Btext-overflow%3Aellipsis%3Bwhite-space%3Anowrap%22%3E%24%7Bc.title%7D%3C/span%3E%3Cspan%20style%3D%22opacity%3A.6%22%3E%24%7Bnew%20Date%28c.created%29.toLocaleDateString%28%29%7D%3C/span%3E%60%3B%0A%20%20%20%20%20%20chatBtn.onclick%20%3D%20%28%29%3D%3E%7BloadChat%28c.id%29%3B%20backdropList.classList.remove%28%27open%27%29%3B%20sheetList.classList.remove%28%27open%27%29%3B%7D%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20const%20deleteBtn%20%3D%20document.createElement%28%27button%27%29%3B%0A%20%20%20%20%20%20deleteBtn.className%20%3D%20%27btn%27%3B%0A%20%20%20%20%20%20deleteBtn.innerHTML%20%3D%20%27%uD83D%uDDD1%uFE0F%27%3B%0A%20%20%20%20%20%20deleteBtn.style.flexShrink%20%3D%20%270%27%3B%0A%20%20%20%20%20%20deleteBtn.title%20%3D%20%27X%F3a%20cu%u1ED9c%20tr%F2%20chuy%u1EC7n%20n%E0y%27%3B%0A%20%20%20%20%20%20deleteBtn.onclick%20%3D%20%28e%29%3D%3E%7B%0A%20%20%20%20%20%20%20%20e.stopPropagation%28%29%3B%0A%20%20%20%20%20%20%20%20if%28confirm%28%60X%F3a%20cu%u1ED9c%20tr%F2%20chuy%u1EC7n%20%22%24%7Bc.title%7D%22%3F%60%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20store.remove%28c.id%29%3B%0A%20%20%20%20%20%20%20%20%20%20if%28CURRENT%20%26%26%20CURRENT.id%20%3D%3D%3D%20c.id%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20list%20%3D%20store.list%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%28list.length%20%3E%200%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20loadChat%28list%5B0%5D.id%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20newChat%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20renderList%28%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20item.appendChild%28chatBtn%29%3B%0A%20%20%20%20%20%20item.appendChild%28deleteBtn%29%3B%0A%20%20%20%20%20%20chatList.appendChild%28item%29%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%7D%0A%20%20%0A%20%20function%20download%28filename%2C%20text%29%20%7B%0A%20%20%20%20const%20element%20%3D%20document.createElement%28%27a%27%29%3B%0A%20%20%20%20element.setAttribute%28%27href%27%2C%20%27data%3Atext/plain%3Bcharset%3Dutf-8%2C%27%20+%20encodeURIComponent%28text%29%29%3B%0A%20%20%20%20element.setAttribute%28%27download%27%2C%20filename%29%3B%0A%20%20%20%20element.style.display%20%3D%20%27none%27%3B%0A%20%20%20%20document.body.appendChild%28element%29%3B%0A%20%20%20%20element.click%28%29%3B%0A%20%20%20%20document.body.removeChild%28element%29%3B%0A%20%20%7D%0A%20%20%0A%20%20%24%28%27%23btnExportJson%27%29.onclick%20%3D%20%28%29%3D%3E%7Bdownload%28%27chats.json%27%2C%20JSON.stringify%28store.list%28%29%2Cnull%2C2%29%29%3B%7D%3B%0A%20%20%24%28%27%23btnExportMd%27%29.onclick%20%3D%20%28%29%3D%3E%7B%0A%20%20%20%20if%28%21CURRENT%29%20return%3B%0A%20%20%20%20const%20lines%3D%5B%60%23%20%24%7BCURRENT.title%7D%5Cn%60%5D%3B%0A%20%20%20%20CURRENT.msgs.forEach%28m%3D%3E%7Blines.push%28m.role%3D%3D%3D%27user%27%3F%27%23%23%20%uD83D%uDC64%20User%27%3A%27%23%23%20%uD83E%uDD16%20Assistant%27%2C%27%27%2Cm.content%7C%7C%27%27%2C%27%27%29%3B%7D%29%3B%0A%20%20%20%20download%28%28CURRENT.title%7C%7C%27chat%27%29+%27.md%27%2C%20lines.join%28%27%5Cn%27%29%29%3B%0A%20%20%7D%3B%0A%0A%20%20const%20sheet%20%3D%20%24%28%27%23sheet%27%29%3B%0A%20%20const%20backdrop%20%3D%20%24%28%27%23backdrop%27%29%3B%0A%20%20%0A%20%20function%20getModelName%28modelValue%29%20%7B%0A%20%20%20%20const%20names%20%3D%20%7B%0A%20%20%20%20%20%20%27claude-3-5-haiku-20241022%27%3A%20%27Haiku%203.5%27%2C%0A%20%20%20%20%20%20%27claude-3-5-sonnet-20241022%27%3A%20%27Sonnet%203.5%27%2C%0A%20%20%20%20%20%20%27claude-sonnet-4-20250514%27%3A%20%27Sonnet%204%27%2C%0A%20%20%20%20%20%20%27claude-sonnet-4-5-20250929%27%3A%20%27Sonnet%204.5%27%2C%0A%20%20%20%20%20%20%27claude-opus-4-20250514%27%3A%20%27Opus%204%27%2C%0A%20%20%20%20%20%20%27claude-opus-4-1-20250805%27%3A%20%27Opus%204.1%27%0A%20%20%20%20%7D%3B%0A%20%20%20%20return%20names%5BmodelValue%5D%20%7C%7C%20%27Claude%27%3B%0A%20%20%7D%0A%20%20%0A%20%20function%20openSettings%28%29%7B%0A%20%20%20%20%24%28%27%23inpKey%27%29.value%20%3D%20CFG.key%3B%0A%20%20%20%20%24%28%27%23inpModel%27%29.value%3DCFG.model%3B%0A%20%20%20%20%24%28%27%23inpTemp%27%29.value%3DCFG.temp%3B%0A%20%20%20%20%24%28%27%23inpMaxTok%27%29.value%3DCFG.max_tokens%3B%0A%20%20%20%20%24%28%27%23inpSystem%27%29.value%3DCFG.system%3B%0A%20%20%20%20backdrop.classList.add%28%27open%27%29%3B%0A%20%20%20%20sheet.classList.add%28%27open%27%29%3B%0A%20%20%7D%0A%20%20%0A%20%20%24%28%27%23closeSheet%27%29.onclick%20%3D%20%28%29%3D%3E%7Bbackdrop.classList.remove%28%27open%27%29%3Bsheet.classList.remove%28%27open%27%29%3B%7D%3B%0A%20%20backdrop.onclick%20%3D%20%24%28%27%23closeSheet%27%29.onclick%3B%0A%20%20%0A%20%20%24%28%27%23btnSaveCfg%27%29.onclick%20%3D%20%28%29%3D%3E%7B%0A%20%20%20%20CFG.key%20%3D%20%24%28%27%23inpKey%27%29.value.trim%28%29%3B%0A%20%20%20%20CFG.model%3D%24%28%27%23inpModel%27%29.value%3B%0A%20%20%20%20CFG.temp%3DNumber%28%24%28%27%23inpTemp%27%29.value%29%7C%7C0.7%3B%0A%20%20%20%20CFG.max_tokens%3DNumber%28%24%28%27%23inpMaxTok%27%29.value%29%7C%7C4096%3B%0A%20%20%20%20CFG.system%3D%24%28%27%23inpSystem%27%29.value%3B%0A%20%20%20%20saveCfg%28%29%3B%0A%20%20%20%20modelChip.textContent%20%3D%20getModelName%28CFG.model%29%3B%0A%20%20%20%20backdrop.classList.remove%28%27open%27%29%3B%0A%20%20%20%20sheet.classList.remove%28%27open%27%29%3B%0A%20%20%20%20addMsg%28%27assistant%27%2C%27%u2705%20%u0110%E3%20l%u01B0u%20c%E0i%20%u0111%u1EB7t.%27%29%3B%0A%20%20%7D%3B%0A%20%20%0A%20%20%24%28%27%23btnClearChat%27%29.onclick%20%3D%20%28%29%3D%3E%7B%0A%20%20%20%20if%28%21CURRENT%29%20return%3B%0A%20%20%20%20if%28confirm%28%27X%F3a%20h%u1ED9i%20tho%u1EA1i%20hi%u1EC7n%20t%u1EA1i%3F%27%29%29%7B%0A%20%20%20%20%20%20store.remove%28CURRENT.id%29%3B%0A%20%20%20%20%20%20const%20rest%3Dstore.list%28%29%3B%0A%20%20%20%20%20%20if%28rest%5B0%5D%29%20loadChat%28rest%5B0%5D.id%29%3B%0A%20%20%20%20%20%20else%20newChat%28%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%3B%0A%0A%20%20//%20%3D%3D%3D%3D%3D%20H%u1EC6%20TH%u1ED0NG%20CU%u1ED8N%20TH%D4NG%20MINH%20%3D%3D%3D%3D%3D%0A%20%20let%20isGenerating%20%3D%20false%3B%0A%20%20let%20userScrolled%20%3D%20false%3B%0A%20%20let%20scrollTimeout%20%3D%20null%3B%0A%0A%20%20function%20isNearBottom%28%29%20%7B%0A%20%20%20%20const%20threshold%20%3D%20150%3B%0A%20%20%20%20return%20scroller.scrollHeight%20-%20scroller.scrollTop%20-%20scroller.clientHeight%20%3C%20threshold%3B%0A%20%20%7D%0A%0A%20%20function%20scrollToBottom%28%29%7B%0A%20%20%20%20if%20%28%21userScrolled%20%7C%7C%20isNearBottom%28%29%29%20%7B%0A%20%20%20%20%20%20requestAnimationFrame%28%28%29%3D%3E%7B%0A%20%20%20%20%20%20%20%20scroller.scrollTop%20%3D%20scroller.scrollHeight%3B%0A%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20//%20Theo%20d%F5i%20khi%20user%20cu%u1ED9n%0A%20%20scroller.addEventListener%28%27scroll%27%2C%20%28%29%20%3D%3E%20%7B%0A%20%20%20%20clearTimeout%28scrollTimeout%29%3B%0A%20%20%20%20%0A%20%20%20%20if%20%28isGenerating%29%20%7B%0A%20%20%20%20%20%20//%20Ki%u1EC3m%20tra%20xem%20user%20c%F3%20cu%u1ED9n%20l%EAn%20kh%F4ng%0A%20%20%20%20%20%20const%20isAtBottom%20%3D%20isNearBottom%28%29%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20if%20%28isAtBottom%29%20%7B%0A%20%20%20%20%20%20%20%20userScrolled%20%3D%20false%3B%20//%20User%20%u0111%E3%20cu%u1ED9n%20v%u1EC1%20cu%u1ED1i%2C%20ti%u1EBFp%20t%u1EE5c%20auto-scroll%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20userScrolled%20%3D%20true%3B%20//%20User%20%u0111ang%20xem%20tin%20nh%u1EAFn%20%u1EDF%20tr%EAn%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20//%20Reset%20userScrolled%20sau%201%20gi%E2y%20kh%F4ng%20cu%u1ED9n%0A%20%20%20%20scrollTimeout%20%3D%20setTimeout%28%28%29%20%3D%3E%20%7B%0A%20%20%20%20%20%20if%20%28isGenerating%20%26%26%20isNearBottom%28%29%29%20%7B%0A%20%20%20%20%20%20%20%20userScrolled%20%3D%20false%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%2C%201000%29%3B%0A%20%20%7D%29%3B%0A%0A%20%20function%20md%28content%29%7B%0A%20%20%20%20if%28%21content%29%20return%20%27%27%3B%0A%20%20%20%20let%20html%20%3D%20content%0A%20%20%20%20%20%20.replace%28/%26/g%2C%27%26amp%3B%27%29%0A%20%20%20%20%20%20.replace%28/%3C/g%2C%27%26lt%3B%27%29%0A%20%20%20%20%20%20.replace%28/%3E/g%2C%27%26gt%3B%27%29%3B%0A%20%20%20%20%0A%20%20%20%20//%20Code%20blocks%20v%u1EDBi%20language%20detection%0A%20%20%20%20html%20%3D%20html.replace%28/%60%60%60%28%5Cw+%29%3F%5Cn%28%5B%5Cs%5CS%5D*%3F%29%60%60%60/g%2C%20%28match%2C%20lang%2C%20code%29%20%3D%3E%20%7B%0A%20%20%20%20%20%20const%20language%20%3D%20lang%20%7C%7C%20%27text%27%3B%0A%20%20%20%20%20%20const%20escapedCode%20%3D%20code.trim%28%29%3B%0A%20%20%20%20%20%20const%20encoded%20%3D%20encodeURIComponent%28escapedCode%29%3B%0A%20%20%20%20%20%20return%20%60%3Cpre%3E%3Ccode%20class%3D%22language-%24%7Blanguage%7D%22%3E%3Cdiv%20class%3D%22code-header%22%3E%3Cspan%3E%24%7Blanguage.toUpperCase%28%29%7D%3C/span%3E%3Cbutton%20class%3D%22copy-btn%22%20data-copy%3D%22%24%7Bencoded%7D%22%3ECopy%3C/button%3E%3C/div%3E%24%7BescapedCode%7D%3C/code%3E%3C/pre%3E%60%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20%0A%20%20%20%20//%20Inline%20code%0A%20%20%20%20html%20%3D%20html.replace%28/%60%28%5B%5E%60%5D+%3F%29%60/g%2C%27%3Ccode%3E%241%3C/code%3E%27%29%3B%0A%20%20%20%20%0A%20%20%20%20//%20Bold%20%26%20italic%0A%20%20%20%20html%20%3D%20html.replace%28/%5C*%5C*%28.+%3F%29%5C*%5C*/g%2C%27%3Cstrong%3E%241%3C/strong%3E%27%29%3B%0A%20%20%20%20html%20%3D%20html.replace%28/%5C*%28.+%3F%29%5C*/g%2C%27%3Cem%3E%241%3C/em%3E%27%29%3B%0A%20%20%20%20%0A%20%20%20%20//%20Headers%0A%20%20%20%20html%20%3D%20html.replace%28/%5E%23%23%23%20%28.+%29%24/gm%2C%27%3Ch4%3E%241%3C/h4%3E%27%29%3B%0A%20%20%20%20html%20%3D%20html.replace%28/%5E%23%23%20%28.+%29%24/gm%2C%27%3Ch3%3E%241%3C/h3%3E%27%29%3B%0A%20%20%20%20html%20%3D%20html.replace%28/%5E%23%20%28.+%29%24/gm%2C%27%3Ch2%3E%241%3C/h2%3E%27%29%3B%0A%20%20%20%20%0A%20%20%20%20//%20Links%0A%20%20%20%20html%20%3D%20html.replace%28/%5C%5B%28.+%3F%29%5C%5D%5C%28%28https%3F%3A%5C/%5C/%5B%5E%5Cs%5D+%29%5C%29/g%2C%27%3Ca%20href%3D%22%242%22%20target%3D%22_blank%22%20rel%3D%22noopener%22%3E%241%3C/a%3E%27%29%3B%0A%20%20%20%20%0A%20%20%20%20//%20Line%20breaks%0A%20%20%20%20html%20%3D%20html.replace%28/%5Cn/g%2C%27%3Cbr%3E%27%29%3B%0A%20%20%20%20%0A%20%20%20%20return%20html%3B%0A%20%20%7D%0A%0A%20%20function%20addMsg%28role%2C%20content%2C%20attachments%29%7B%0A%20%20%20%20//%20X%F3a%20empty%20state%20khi%20c%F3%20tin%20nh%u1EAFn%20%u0111%u1EA7u%20ti%EAn%0A%20%20%20%20const%20emptyState%20%3D%20scroller.querySelector%28%27.empty-state%27%29%3B%0A%20%20%20%20if%28emptyState%20%26%26%20scroller.children.length%20%3D%3D%3D%201%29%20%7B%0A%20%20%20%20%20%20emptyState.remove%28%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20const%20row%20%3D%20document.createElement%28%27div%27%29%3B%0A%20%20%20%20row.className%3D%27row%20%27+role%3B%0A%20%20%20%20const%20b%3Ddocument.createElement%28%27div%27%29%3B%0A%20%20%20%20b.className%3D%27bubble%20%27+role%3B%0A%20%20%20%20%0A%20%20%20%20if%28role%3D%3D%3D%27assistant%27%29%20%7B%0A%20%20%20%20%20%20b.innerHTML%20%3D%20md%28content%29%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20if%20%28content%20%26%26%20content%20%21%3D%3D%20%27%5BG%u1EEDi%20t%u1EC7p%5D%27%29%20%7B%0A%20%20%20%20%20%20%20%20const%20textNode%20%3D%20document.createElement%28%27div%27%29%3B%0A%20%20%20%20%20%20%20%20textNode.textContent%20%3D%20content%3B%0A%20%20%20%20%20%20%20%20b.appendChild%28textNode%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20if%28attachments%20%26%26%20attachments.length%29%7B%0A%20%20%20%20%20%20%20%20const%20wrap%3Ddocument.createElement%28%27div%27%29%3B%0A%20%20%20%20%20%20%20%20wrap.style.marginTop%3D%276px%27%3B%0A%20%20%20%20%20%20%20%20attachments.forEach%28a%3D%3E%7B%0A%20%20%20%20%20%20%20%20%20%20if%28a.type.startsWith%28%27image/%27%29%29%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20img%20%3D%20document.createElement%28%27img%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20img.src%20%3D%20%60data%3A%24%7Ba.type%7D%3Bbase64%2C%24%7Ba.b64%7D%60%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20img.className%20%3D%20%27image-attachment%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20img.alt%20%3D%20a.name%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20wrap.appendChild%28img%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20pill%3Ddocument.createElement%28%27span%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20pill.className%3D%27file-pill%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20pill.textContent%3D%27%uD83D%uDCCE%20%27+a.name%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20wrap.appendChild%28pill%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20b.appendChild%28wrap%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20row.appendChild%28b%29%3B%0A%20%20%20%20scroller.appendChild%28row%29%3B%0A%20%20%20%20scrollToBottom%28%29%3B%0A%20%20%20%20return%20b%3B%0A%20%20%7D%0A%0A%20%20function%20renderMath%28node%29%7B%0A%20%20%20%20try%7B%0A%20%20%20%20%20%20if%28window.renderMathInElement%29%7B%0A%20%20%20%20%20%20%20%20renderMathInElement%28node%2C%7Bdelimiters%3A%5B%7Bleft%3A%27%2Cright%3A%27%2Cdisplay%3Atrue%7D%2C%7Bleft%3A%27%24%27%2Cright%3A%27%24%27%2Cdisplay%3Afalse%7D%2C%7Bleft%3A%27%5C%5C%28%27%2Cright%3A%27%5C%5C%29%27%2Cdisplay%3Afalse%7D%2C%7Bleft%3A%27%5C%5C%5B%27%2Cright%3A%27%5C%5C%5D%27%2Cdisplay%3Atrue%7D%5D%7D%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7Dcatch%28e%29%7B%7D%0A%20%20%7D%0A%0A%20%20function%20showThinking%28%29%7B%0A%20%20%20%20think.style.display%3D%27block%27%3B%0A%20%20%20%20dots.innerHTML%3D%27%27%3B%0A%20%20%20%20setTimeout%28%28%29%20%3D%3E%20%7B%0A%20%20%20%20%20%20think.classList.add%28%27show%27%29%3B%0A%20%20%20%20%7D%2C%2010%29%3B%0A%20%20%7D%0A%20%20%0A%20%20function%20hideThinking%28%29%7B%0A%20%20%20%20think.classList.remove%28%27show%27%29%3B%0A%20%20%20%20think.classList.add%28%27fade-out%27%29%3B%0A%20%20%20%20setTimeout%28%28%29%20%3D%3E%20%7B%0A%20%20%20%20%20%20think.style.display%3D%27none%27%3B%0A%20%20%20%20%20%20think.classList.remove%28%27fade-out%27%29%3B%0A%20%20%20%20%7D%2C%20300%29%3B%0A%20%20%7D%0A%20%20%0A%20%20function%20setMilestones%28list%29%7B%0A%20%20%20%20dots.innerHTML%3D%27%27%3B%0A%20%20%20%20list.forEach%28m%3D%3E%7B%0A%20%20%20%20%20%20const%20d%3Ddocument.createElement%28%27div%27%29%3B%0A%20%20%20%20%20%20d.className%3D%27dot%20%27+%28m.status%7C%7C%27%27%29%3B%0A%20%20%20%20%20%20d.innerHTML%3D%60%3Ci%3E%3C/i%3E%3Cspan%3E%24%7Bm.text%7D%3C/span%3E%60%3B%0A%20%20%20%20%20%20dots.appendChild%28d%29%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%7D%0A%20%20%0A%20%20btnToggleThink.onclick%20%3D%20%28%29%3D%3E%7B%0A%20%20%20%20const%20body%3D%24%28%27%23thinkBody%27%29%3B%0A%20%20%20%20body.style.display%20%3D%20body.style.display%3D%3D%3D%27none%27%3F%27%27%3A%27none%27%3B%0A%20%20%20%20btnToggleThink.textContent%20%3D%20body.style.display%3D%3D%3D%27none%27%20%3F%20%27M%u1EDF%20r%u1ED9ng%27%20%3A%20%27Thu%20g%u1ECDn%27%3B%0A%20%20%7D%3B%0A%0A%20%20let%20pending%20%3D%20%5B%5D%3B%0A%20%20const%20file%20%3D%20%24%28%27%23file%27%29%3B%0A%20%20%24%28%27%23btnAttach%27%29.onclick%20%3D%20%28%29%3D%3E%20file.click%28%29%3B%0A%20%20%0A%20%20file.onchange%20%3D%20async%20%28e%29%3D%3E%7B%0A%20%20%20%20const%20f%3De.target.files%5B0%5D%3B%0A%20%20%20%20if%28%21f%29%20return%3B%0A%20%20%20%20if%28f.size%3E8*1024*1024%29%20return%20alert%28%27T%u1ED1i%20%u0111a%208MB%27%29%3B%0A%20%20%20%20const%20b64%3Dawait%20toB64%28f%29%3B%0A%20%20%20%20pending.push%28%7Bname%3Af.name%2Ctype%3Af.type%2Csize%3Af.size%2Cb64%7D%29%3B%0A%20%20%20%20renderAttach%28%29%3B%0A%20%20%20%20file.value%3D%27%27%3B%0A%20%20%7D%3B%0A%20%20%0A%20%20document.addEventListener%28%27paste%27%2C%20async%20%28e%29%3D%3E%7B%0A%20%20%20%20const%20it%3D%5B...%28e.clipboardData%3F.items%7C%7C%5B%5D%29%5D.find%28i%3D%3Ei.type.startsWith%28%27image/%27%29%29%3B%0A%20%20%20%20if%28it%29%7B%0A%20%20%20%20%20%20const%20f%3Dit.getAsFile%28%29%3B%0A%20%20%20%20%20%20const%20b64%3Dawait%20toB64%28f%29%3B%0A%20%20%20%20%20%20pending.push%28%7Bname%3Af.name%7C%7C%27pasted.png%27%2C%20type%3Af.type%2C%20size%3Af.size%2C%20b64%7D%29%3B%0A%20%20%20%20%20%20renderAttach%28%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%29%3B%0A%20%20%0A%20%20function%20renderAttach%28%29%7B%0A%20%20%20%20const%20wrap%3D%24%28%27%23attachList%27%29%3B%0A%20%20%20%20wrap.innerHTML%3D%27%27%3B%0A%20%20%20%20pending.forEach%28%28a%2Ci%29%3D%3E%7B%0A%20%20%20%20%20%20const%20s%3Ddocument.createElement%28%27span%27%29%3B%0A%20%20%20%20%20%20s.className%3D%27file-pill%27%3B%0A%20%20%20%20%20%20if%28a.type.startsWith%28%27image/%27%29%29%7B%0A%20%20%20%20%20%20%20%20const%20img%20%3D%20document.createElement%28%27img%27%29%3B%0A%20%20%20%20%20%20%20%20img.src%20%3D%20%60data%3A%24%7Ba.type%7D%3Bbase64%2C%24%7Ba.b64%7D%60%3B%0A%20%20%20%20%20%20%20%20img.style.width%20%3D%20%2720px%27%3B%0A%20%20%20%20%20%20%20%20img.style.height%20%3D%20%2720px%27%3B%0A%20%20%20%20%20%20%20%20img.style.objectFit%20%3D%20%27cover%27%3B%0A%20%20%20%20%20%20%20%20img.style.borderRadius%20%3D%20%274px%27%3B%0A%20%20%20%20%20%20%20%20img.style.marginRight%20%3D%20%274px%27%3B%0A%20%20%20%20%20%20%20%20s.innerHTML%20%3D%20%27%27%3B%0A%20%20%20%20%20%20%20%20s.appendChild%28img%29%3B%0A%20%20%20%20%20%20%20%20s.appendChild%28document.createTextNode%28a.name%29%29%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20s.innerHTML%3D%60%uD83D%uDCCE%20%24%7Ba.name%7D%60%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20s.innerHTML%20+%3D%20%60%20%3Cbutton%20data-i%3D%22%24%7Bi%7D%22%20style%3D%22border%3Anone%3Bbackground%3Atransparent%3Bfont-size%3A14px%22%3E%u2716%3C/button%3E%60%3B%0A%20%20%20%20%20%20s.querySelector%28%27button%27%29.onclick%3D%28ev%29%3D%3E%7B%0A%20%20%20%20%20%20%20%20const%20k%3DNumber%28ev.target.dataset.i%29%3B%0A%20%20%20%20%20%20%20%20pending.splice%28k%2C1%29%3B%0A%20%20%20%20%20%20%20%20renderAttach%28%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20wrap.appendChild%28s%29%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%7D%0A%20%20%0A%20%20function%20toB64%28file%29%7B%0A%20%20%20%20return%20new%20Promise%28%28res%2Crej%29%3D%3E%7B%0A%20%20%20%20%20%20const%20r%3Dnew%20FileReader%28%29%3B%0A%20%20%20%20%20%20r.onload%3D%28%29%3D%3Eres%28r.result.split%28%27%2C%27%29%5B1%5D%29%3B%0A%20%20%20%20%20%20r.onerror%3Drej%3B%0A%20%20%20%20%20%20r.readAsDataURL%28file%29%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%7D%0A%0A%20%20function%20apiUrl%28%29%7B%0A%20%20%20%20const%20dev%20%3D%20location.protocol%3D%3D%3D%27file%3A%27%20%7C%7C%20%5B%27localhost%27%2C%27127.0.0.1%27%5D.includes%28location.hostname%29%3B%0A%20%20%20%20return%20dev%3F%20%27https%3A//corsproxy.io/%3Fhttps%3A//api.anthropic.com/v1/messages%27%20%3A%20%27https%3A//api.anthropic.com/v1/messages%27%3B%0A%20%20%7D%0A%20%20%0A%20%20let%20controller%3Dnull%3B%0A%20%20%0A%20%20async%20function*%20claudeStream%28%7BapiKey%2C%20model%2C%20msgs%2C%20temperature%2C%20max_tokens%7D%29%7B%0A%20%20%20%20const%20headers%3D%7B%27Content-Type%27%3A%27application/json%27%2C%27x-api-key%27%3AapiKey%2C%27anthropic-version%27%3A%272023-06-01%27%7D%3B%0A%20%20%20%20const%20body%3D%7B%0A%20%20%20%20%20%20model%2C%0A%20%20%20%20%20%20temperature%2C%0A%20%20%20%20%20%20max_tokens%2C%0A%20%20%20%20%20%20stream%3Atrue%2C%0A%20%20%20%20%20%20messages%3A%20msgs.map%28m%3D%3E%7B%0A%20%20%20%20%20%20%20%20if%28m.role%3D%3D%3D%27user%27%26%26m.attachments%3F.length%29%7B%0A%20%20%20%20%20%20%20%20%20%20const%20content%3D%5B%7Btype%3A%27text%27%2Ctext%3Am.content%7D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20m.attachments.forEach%28a%3D%3E%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%28a.type.startsWith%28%27image/%27%29%29%20content.push%28%7Btype%3A%27image%27%2C%20source%3A%7Btype%3A%27base64%27%2C%20media_type%3Aa.type%2C%20data%3Aa.b64%7D%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20content.push%28%7Btype%3A%27text%27%2Ctext%3A%60%5BT%u1EC7p%3A%20%24%7Ba.name%7D%5D%60%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20return%20%7Brole%3A%27user%27%2Ccontent%7D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20%7Brole%3Am.role%2C%20content%3Am.content%7D%3B%0A%20%20%20%20%20%20%7D%29%0A%20%20%20%20%7D%3B%0A%20%20%20%20%0A%20%20%20%20if%28CFG.system%29%20body.system%3DCFG.system%3B%0A%20%20%20%20%0A%20%20%20%20controller%20%3D%20new%20AbortController%28%29%3B%0A%20%20%20%20const%20resp%20%3D%20await%20fetch%28apiUrl%28%29%2C%7Bmethod%3A%27POST%27%2Cheaders%2Cbody%3AJSON.stringify%28body%29%2Csignal%3Acontroller.signal%7D%29%3B%0A%20%20%20%20%0A%20%20%20%20if%28%21resp.ok%29%7B%0A%20%20%20%20%20%20throw%20new%20Error%28%60API%20%24%7Bresp.status%7D%3A%20%24%7Bawait%20resp.text%28%29%7D%60%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20const%20reader%3Dresp.body.getReader%28%29%3B%0A%20%20%20%20const%20decoder%3Dnew%20TextDecoder%28%29%3B%0A%20%20%20%20let%20buf%3D%27%27%3B%0A%20%20%20%20%0A%20%20%20%20setMilestones%28%5B%0A%20%20%20%20%20%20%7Btext%3A%27K%u1EBFt%20n%u1ED1i%20API%27%2Cstatus%3A%27done%27%7D%2C%0A%20%20%20%20%20%20%7Btext%3A%27Ph%E2n%20t%EDch%20y%EAu%20c%u1EA7u%27%2Cstatus%3A%27active%27%7D%2C%0A%20%20%20%20%20%20%7Btext%3A%27Sinh%20n%u1ED9i%20dung%27%2Cstatus%3A%27%27%7D%0A%20%20%20%20%5D%29%3B%0A%20%20%20%20showThinking%28%29%3B%0A%20%20%20%20%0A%20%20%20%20while%28true%29%7B%0A%20%20%20%20%20%20const%20%7Bdone%2Cvalue%7D%3Dawait%20reader.read%28%29%3B%0A%20%20%20%20%20%20if%28done%29%20break%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20buf+%3Ddecoder.decode%28value%2C%7Bstream%3Atrue%7D%29%3B%0A%20%20%20%20%20%20const%20lines%3Dbuf.split%28%27%5Cn%27%29%3B%0A%20%20%20%20%20%20buf%3Dlines.pop%28%29%7C%7C%27%27%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20for%28const%20line%20of%20lines%29%7B%0A%20%20%20%20%20%20%20%20if%28%21line.trim%28%29%20%7C%7C%20%21line.startsWith%28%27data%3A%27%29%29%20continue%3B%0A%20%20%20%20%20%20%20%20const%20data%3Dline.slice%285%29.trim%28%29%3B%0A%20%20%20%20%20%20%20%20if%28data%3D%3D%3D%27%5BDONE%5D%27%29%20continue%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20try%7B%0A%20%20%20%20%20%20%20%20%20%20const%20evt%3DJSON.parse%28data%29%3B%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%28evt.type%3D%3D%3D%27content_block_start%27%29%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20setMilestones%28%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Btext%3A%27K%u1EBFt%20n%u1ED1i%20API%27%2Cstatus%3A%27done%27%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Btext%3A%27Ph%E2n%20t%EDch%20y%EAu%20c%u1EA7u%27%2Cstatus%3A%27done%27%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Btext%3A%27Sinh%20n%u1ED9i%20dung%27%2Cstatus%3A%27active%27%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%28evt.type%3D%3D%3D%27content_block_delta%27%20%26%26%20evt.delta%3F.text%29%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20yield%20%7Btype%3A%27delta%27%2C%20text%3Aevt.delta.text%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20if%28evt.type%3D%3D%3D%27message_stop%27%29%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20setMilestones%28%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Btext%3A%27K%u1EBFt%20n%u1ED1i%20API%27%2Cstatus%3A%27done%27%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Btext%3A%27Ph%E2n%20t%EDch%20y%EAu%20c%u1EA7u%27%2Cstatus%3A%27done%27%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Btext%3A%27Sinh%20n%u1ED9i%20dung%27%2Cstatus%3A%27done%27%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20yield%20%7Btype%3A%27done%27%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7Dcatch%28e%29%7B%0A%20%20%20%20%20%20%20%20%20%20console.error%28%27Parse%20error%3A%27%2C%20e%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20function%20msgsForAPI%28%29%7B%0A%20%20%20%20return%20%28CURRENT%3F.msgs%7C%7C%5B%5D%29.map%28m%3D%3E%28%7Brole%3Am.role%2Ccontent%3Am.content%2Cattachments%3Am.attachments%7D%29%29%3B%0A%20%20%7D%0A%0A%20%20%24%28%27%23form%27%29.addEventListener%28%27submit%27%2C%20async%20%28e%29%3D%3E%7B%0A%20%20%20%20e.preventDefault%28%29%3B%0A%20%20%20%20if%28isGenerating%29%20return%3B%0A%20%20%20%20%0A%20%20%20%20const%20prompt%20%3D%20text.value.trim%28%29%3B%0A%20%20%20%20if%28%21prompt%20%26%26%20pending.length%3D%3D%3D0%29%20return%3B%0A%20%20%20%20%0A%20%20%20%20const%20userMsg%3D%7Brole%3A%27user%27%2Ccontent%3A%20prompt%7C%7C%27%5BG%u1EEDi%20t%u1EC7p%5D%27%2C%20attachments%3A%20pending.slice%28%29%7D%3B%0A%20%20%20%20pending.length%3D0%3B%0A%20%20%20%20renderAttach%28%29%3B%0A%20%20%20%20%0A%20%20%20%20if%28%21CURRENT%29%20newChat%28userMsg%29%3B%0A%20%20%20%20else%20%7B%0A%20%20%20%20%20%20CURRENT.msgs.push%28userMsg%29%3B%0A%20%20%20%20%20%20saveCurrent%28%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20addMsg%28%27user%27%2C%20userMsg.content%2C%20userMsg.attachments%29%3B%0A%20%20%20%20text.value%3D%27%27%3B%0A%20%20%20%20autoGrow%28%29%3B%0A%20%20%20%20%0A%20%20%20%20await%20generate%28%29%3B%0A%20%20%7D%29%3B%0A%0A%20%20async%20function%20generate%28%29%7B%0A%20%20%20%20if%28%21CFG.key%29%20return%20alert%28%27H%E3y%20nh%u1EADp%20API%20Key%20trong%20C%E0i%20%u0111%u1EB7t.%27%29%3B%0A%20%20%20%20%0A%20%20%20%20isGenerating%20%3D%20true%3B%0A%20%20%20%20userScrolled%20%3D%20false%3B%0A%20%20%20%20sendBtn.disabled%3Dtrue%3B%0A%20%20%20%20sendBtn.textContent%3D%27%u2026%27%3B%0A%20%20%20%20%0A%20%20%20%20const%20bubble%20%3D%20document.createElement%28%27div%27%29%3B%0A%20%20%20%20bubble.className%3D%27bubble%20assistant%27%3B%0A%20%20%20%20bubble.innerHTML%20%3D%20%27%3Cdiv%20class%3D%22typing-dots%22%3E%3Cspan%3E%3C/span%3E%3Cspan%3E%3C/span%3E%3Cspan%3E%3C/span%3E%3C/div%3E%27%3B%0A%20%20%20%20const%20row%20%3D%20document.createElement%28%27div%27%29%3B%0A%20%20%20%20row.className%3D%27row%20assistant%27%3B%0A%20%20%20%20row.appendChild%28bubble%29%3B%0A%20%20%20%20scroller.appendChild%28row%29%3B%0A%20%20%20%20scrollToBottom%28%29%3B%0A%20%20%20%20%0A%20%20%20%20let%20reply%3D%27%27%3B%0A%20%20%20%20%0A%20%20%20%20try%7B%0A%20%20%20%20%20%20for%20await%20%28const%20ev%20of%20claudeStream%28%7B%0A%20%20%20%20%20%20%20%20apiKey%3ACFG.key%2C%0A%20%20%20%20%20%20%20%20model%3ACFG.model%2C%0A%20%20%20%20%20%20%20%20msgs%3AmsgsForAPI%28%29%2C%0A%20%20%20%20%20%20%20%20temperature%3ACFG.temp%2C%0A%20%20%20%20%20%20%20%20max_tokens%3ACFG.max_tokens%0A%20%20%20%20%20%20%7D%29%29%7B%0A%20%20%20%20%20%20%20%20if%28ev.type%3D%3D%3D%27delta%27%20%26%26%20ev.text%29%7B%0A%20%20%20%20%20%20%20%20%20%20reply+%3Dev.text%3B%0A%20%20%20%20%20%20%20%20%20%20bubble.innerHTML%20%3D%20md%28reply%29%3B%0A%20%20%20%20%20%20%20%20%20%20scrollToBottom%28%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%28ev.type%3D%3D%3D%27done%27%29%7B%0A%20%20%20%20%20%20%20%20%20%20bubble.innerHTML%20%3D%20md%28reply%7C%7C%27Kh%F4ng%20nh%u1EADn%20%u0111%u01B0%u1EE3c%20ph%u1EA3n%20h%u1ED3i.%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20hideThinking%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20renderMath%28bubble%29%3B%0A%20%20%20%20%20%20%20%20%20%20CURRENT.msgs.push%28%7Brole%3A%27assistant%27%2Ccontent%3Areply%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20saveCurrent%28%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7Dcatch%28err%29%7B%0A%20%20%20%20%20%20bubble.innerHTML%20%3D%20%27%u274C%20L%u1ED7i%3A%20%27+%28err.message%7C%7Cerr%29%3B%0A%20%20%20%20%20%20hideThinking%28%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20finally%7B%0A%20%20%20%20%20%20isGenerating%20%3D%20false%3B%0A%20%20%20%20%20%20userScrolled%20%3D%20false%3B%0A%20%20%20%20%20%20sendBtn.disabled%3Dfalse%3B%0A%20%20%20%20%20%20sendBtn.textContent%3D%27G%u1EEDi%27%3B%0A%20%20%20%20%20%20controller%3Dnull%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20function%20autoGrow%28%29%7B%0A%20%20%20%20text.style.height%3D%27auto%27%3B%0A%20%20%20%20text.style.height%3DMath.min%28text.scrollHeight%2C140%29+%27px%27%3B%0A%20%20%7D%0A%20%20%0A%20%20text.addEventListener%28%27input%27%2C%20autoGrow%29%3B%0A%20%20text.addEventListener%28%27keydown%27%2C%20%28e%29%3D%3E%7B%0A%20%20%20%20if%28e.key%3D%3D%3D%27Enter%27%20%26%26%20%21e.shiftKey%29%7B%0A%20%20%20%20%20%20e.preventDefault%28%29%3B%0A%20%20%20%20%20%20%24%28%27%23form%27%29.dispatchEvent%28new%20Event%28%27submit%27%29%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%29%3B%0A%0A%20%20%24%28%27%23btnSpeak%27%29.onclick%20%3D%20%28%29%3D%3E%7B%0A%20%20%20%20const%20arr%3D%28CURRENT%3F.msgs%7C%7C%5B%5D%29.filter%28m%3D%3Em.role%3D%3D%3D%27assistant%27%29%3B%0A%20%20%20%20const%20t%3Darr.length%3Farr%5Barr.length-1%5D.content%3A%27%27%3B%0A%20%20%20%20if%28%21t%29%20return%20alert%28%27Ch%u01B0a%20c%F3%20n%u1ED9i%20dung%27%29%3B%0A%20%20%20%20if%28%21%28%27speechSynthesis%27%20in%20window%29%29%20return%20alert%28%27Thi%u1EBFt%20b%u1ECB%20kh%F4ng%20h%u1ED7%20tr%u1EE3%27%29%3B%0A%20%20%20%20const%20u%3Dnew%20SpeechSynthesisUtterance%28t.replace%28/%60%5B%5E%60%5D*%60/g%2C%27%27%29%29%3B%0A%20%20%20%20u.lang%3D%27vi-VN%27%3B%0A%20%20%20%20speechSynthesis.cancel%28%29%3B%0A%20%20%20%20speechSynthesis.speak%28u%29%3B%0A%20%20%7D%3B%0A%0A%20%20let%20rec%3Dnull%3B%0A%20%20%24%28%27%23btnMic%27%29.onclick%20%3D%20%28%29%3D%3E%7B%0A%20%20%20%20const%20SR%3Dwindow.SpeechRecognition%7C%7Cwindow.webkitSpeechRecognition%3B%0A%20%20%20%20if%28%21SR%29%20return%20alert%28%27Thi%u1EBFt%20b%u1ECB%20kh%F4ng%20h%u1ED7%20tr%u1EE3%27%29%3B%0A%20%20%20%20if%28%21rec%29%7B%0A%20%20%20%20%20%20rec%3Dnew%20SR%28%29%3B%0A%20%20%20%20%20%20rec.lang%3D%27vi-VN%27%3B%0A%20%20%20%20%20%20rec.interimResults%3Dfalse%3B%0A%20%20%20%20%20%20rec.maxAlternatives%3D1%3B%0A%20%20%20%20%20%20rec.onresult%3D%28ev%29%3D%3E%7B%0A%20%20%20%20%20%20%20%20const%20t%3Dev.results%5B0%5D%5B0%5D.transcript%3B%0A%20%20%20%20%20%20%20%20text.value%3D%28text.value%3Ftext.value+%27%20%27%3A%27%27%29+t%3B%0A%20%20%20%20%20%20%20%20autoGrow%28%29%3B%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%7D%0A%20%20%20%20rec.start%28%29%3B%0A%20%20%7D%3B%0A%0A%20%20scroller.addEventListener%28%27click%27%2C%20%28e%29%3D%3E%7B%0A%20%20%20%20const%20btn%3De.target.closest%28%27.copy-btn%27%29%3B%0A%20%20%20%20if%28btn%29%7B%0A%20%20%20%20%20%20const%20raw%3DdecodeURIComponent%28btn.dataset.copy%7C%7C%27%27%29%3B%0A%20%20%20%20%20%20navigator.clipboard.writeText%28raw%29.then%28%28%29%3D%3E%7B%0A%20%20%20%20%20%20%20%20btn.textContent%3D%27Copied%20%u2713%27%3B%0A%20%20%20%20%20%20%20%20setTimeout%28%28%29%3D%3Ebtn.textContent%3D%27Copy%27%2C900%29%3B%0A%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%29%3B%0A%0A%20%20%24%28%27%23btnNewChat%27%29.onclick%20%3D%20%28%29%3D%3E%20newChat%28%29%3B%0A%0A%20%20%28function%20init%28%29%7B%0A%20%20%20%20modelChip.textContent%20%3D%20getModelName%28CFG.model%29%3B%0A%20%20%20%20const%20list%3Dstore.list%28%29%3B%0A%20%20%20%20if%28list%5B0%5D%29%20loadChat%28list%5B0%5D.id%29%3B%0A%20%20%20%20else%20newChat%28%29%3B%0A%20%20%7D%29%28%29%3B%0A%7D%29%28%29%3B%0A%3C/script%3E%0A%3C/body%3E%0A%3C/html%3E%22%29%29%3B%0A//--%3E%0A%3C/script%3E"));
//-->
</script>
